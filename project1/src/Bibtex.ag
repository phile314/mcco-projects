

imports
{
import CCO.Tree (ATerm (App), Tree (fromTree, toTree))
import CCO.Tree.Parser (parseTree, app, arg, list)
import Control.Applicative
}

{
type Key = String

}

data BibtexDb
    | BibtexDb entries :: {[BibtexEntry]}

data BibtexEntry
    | Entry etype :: String key :: Key emap :: KVList

type KVList = [ {(Field, String)} ]

data Field
    | Address
    | Annote
    | Author
    | Booktitle
    | Chapter
    | Crossref
    | Edition
    | Editor
    | HowPublished
    | Institution
    | Journal
    | Key
    | Month
    | Note
    | Number
    | Organization
    | Pages
    | Publisher
    | School
    | Series
    | Title
    | Type
    | Volume
    | Year
--    | Unknown fieldName :: String

set Every = BibtexDb BibtexEntry Field
deriving Every : Show, Eq
deriving Field : Bounded, Read

{-attr BibtexDb
    syn html :: HtmlTree

sem BibtexEntry
  -}





{
--------------------------------------------------------------------------------
--- ATerm
--------------------------------------------------------------------------------

instance Tree BibtexDb where
    fromTree (BibtexDb es) = App "BibtexDb" [fromTree es]
    toTree = parseTree [app "BibtexDb" (BibtexDb <$> arg)]

instance Tree BibtexEntry where
    fromTree (Entry t k fv) = App "Entry" [fromTree t, fromTree k, fromTree fv]
    toTree = parseTree [app "Entry" (Entry <$> arg <*> arg <*> arg)]

instance Tree Field where
    fromTree f = App (show f) []
    -- should we use the parser stuff here too?
    toTree (App s [])= return $ read s
}  
